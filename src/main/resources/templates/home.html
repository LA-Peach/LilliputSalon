<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Lilliput Salon - Home</title>
<link rel="stylesheet" href="/css/lilliputSalon.css" />
</head>

<body class="page-gradient">

<header>

    <!-- Dynamic Navigation Based on Role -->
    <div sec:authorize="hasRole('CUSTOMER')"
         th:replace="~{fragments/customer-nav :: customerNav}">
    </div>

    <div sec:authorize="hasRole('STYLIST')"
         th:replace="~{fragments/stylist-nav :: stylistNav}">
    </div>

    <div sec:authorize="hasRole('OWNER')"
         th:replace="~{fragments/owner-nav :: ownerNav}">
    </div>

</header>


<!-- ============================
     CUSTOMER DASHBOARD
============================= -->
<main class="home-layout" sec:authorize="hasRole('CUSTOMER')">

    <!-- Greeting -->
    <h2 th:text="'Welcome, ' + (${firstName} ?: 'Guest') + '!'"></h2>

    <!-- Walk-In Wait Time -->
    <section class="glass-card home-card">
        <h3>Walk-In Wait Time</h3>
        <p class="coming-soon">Coming Soon</p>
        <div class="accent-line"></div>
        <p class="subtext">Real-time estimate based on appointments</p>
    </section>

    <!-- Two-column customer widgets -->
    <div class="grid grid-2">

       <section class="glass-card home-card">
		    <h3>Your Next Appointment</h3>
		    <div class="accent-line"></div>
		
		    <!-- Appointment exists -->
		    <div th:if="${nextAppointment != null}">
		        <p class="subtext">
		            <span th:text="${#temporals.format(nextAppointment.dateTime, 'MMMM d, yyyy h:mm a')}"></span>
		            <span th:text="' · ' + ${nextAppointment.providerName}"></span>
		            <span th:text="' · ' + ${nextAppointment.serviceName}"></span>
		        </p>
		        <a class="button" href="/appointments" role="button">View / Manage</a>
		    </div>
		
		    <!-- No appointment -->
		    <div th:if="${nextAppointment == null}">
		        <p class="subtext">No appointments currently booked</p>
		        <a class="btn btn-secondary" href="/appointments/schedule" role="button">Schedule Now</a>
		    </div>
		</section>


        <!-- Rewards Points -->
        <section class="glass-card home-card">
            <h3>Rewards Points</h3>
            <p class="coming-soon">Coming Soon</p>
            <div class="accent-line"></div>
            <p class="subtext">Track your loyalty points and savings.</p>
        </section>

    </div>

</main>


<!-- ============================
     STYLIST DASHBOARD
============================= -->
<main class="home-layout" sec:authorize="hasRole('STYLIST')">

    <h2 th:text="'Good Morning, ' + (${firstName} ?: 'Stylist') + '!'"></h2>
    
    <!-- Walk-In Wait Time -->
    <section class="glass-card home-card">
        <h3>Walk-In Wait Time</h3>
        <p class="coming-soon">Coming Soon</p>
        <div class="accent-line"></div>
        <p class="subtext">Real-time estimate based on appointments</p>
    </section>
    
     <!-- Two-column customer widgets -->
    <div class="grid grid-2">

	    <section class="glass-card home-card">
	        <h3>Your Next Appointment</h3>
			<div class="accent-line"></div>
			
	        <!-- If a next appointment exists, show details -->
	        <div th:if="${nextStylistAppointment != null}">
	            <p class="subtext">
	                <span th:text="${#temporals.format(nextStylistAppointment.dateTime, 'MMMM d, yyyy h:mm a')}">
	                    <!-- Date/time -->
	                </span>
	            </p>
	            <p class="subtext" th:if="${nextStylistAppointment.clientName}">
	                <span th:text="'Client: ' + ${nextStylistAppointment.clientName}">
	                    <!-- Client name -->
	                </span>
	            </p>
	            <p class="subtext" th:if="${nextStylistAppointment.serviceName}">
	                <span th:text="'Service: ' + ${nextStylistAppointment.serviceName}">
	                    <!-- Service name -->
	                </span>
	            </p>
	        </div>
	
	        <!-- If no upcoming appointment -->
	        <div th:if="${nextStylistAppointment == null}">
	            <p class="subtext">No upcoming appointments.</p>
	        </div>
	    </section>
	    
	    <!-- Stylist Availability Card -->
	    <section class="glass-card home-card">
	        <h3>Your Availability</h3>
	
	      
	        <div class="accent-line"></div>
	
	        <!-- If availability provided -->
	        <div th:if="${stylistAvailability != null}">
	            <!-- Example Format: Monday–Friday, 9AM–5PM OR list entries -->
	            <p class="subtext" th:text="${stylistAvailability}">
	                <!-- Example: "Mon–Fri: 9AM–5PM" -->
	            </p>
	        </div>
	
	        <!-- No data -->
	        <div th:if="${stylistAvailability == null}">
	            <p class="subtext">No availability schedule found.</p>
	        </div>
	    </section>
	</div>
	
	 <!-- Two-column customer widgets -->
    <div class="grid grid-2">
    
	    <!-- Completed Services Count -->
	    <section class="glass-card home-card">
	        <h3>Completed Services</h3>
	
	        
	        <div class="accent-line"></div>
	
	        <!-- If data available -->
	        <div th:if="${completedServicesCount != null}">
	            <p class="subtext">
	                <strong th:text="${completedServicesCount}" style="font-size:1.05rem; color:var(--purple-1)">
	                    <!-- Completed count -->
	                </strong>
	                services completed
	            </p>
	        </div>
	
	        <!-- Fallback -->
	        <div th:if="${completedServicesCount == null}">
	            <p class="subtext">No completed service data found yet.</p>
	        </div>
	    </section>
	    
	    <!-- Top 3 Services -->
	    <section class="glass-card home-card">
	        <h3>Your Top Service Types</h3>
	
	        <div class="accent-line"></div>
	
	        <!-- If top services exist -->
	        <div th:if="${topServiceTypes != null and #lists.size(topServiceTypes) > 0}">
	            <ul style="list-style:none; padding:0; margin:0; font-size:0.85rem; color:var(--muted); text-align:left;">
	                
	                <!-- Loop top 3 only -->
	                <li th:each="service, i : ${topServiceTypes}"
	                    th:if="${i.index < 3}"
	                    style="margin-bottom:4px;">
	                    <strong th:text="${service.name}" style="color:var(--purple-1)"></strong>
	                    — <span th:text="${service.count}"></span> completed
	                </li>
	
	            </ul>
	        </div>
	
	        <!-- If none exist -->
	        <div th:if="${topServiceTypes == null or #lists.size(topServiceTypes) == 0}">
	            <p class="subtext">No service type data available.</p>
	        </div>
	    </section>
	   </div>
    
    

</main>


<!-- ============================
     OWNER DASHBOARD
============================= -->
<main class="home-layout" sec:authorize="hasRole('OWNER')">

    <h2 th:text="'Welcome Back, ' + (${firstName} ?: 'Owner')"></h2>

    <section class="glass-card home-card">
        <h3>Walk-In Wait Time</h3>
        <p class="coming-soon">Coming Soon</p>
        <div class="accent-line"></div>
        <p class="subtext">Real-time estimate based on appointments</p>
    </section>
    
    <!-- Two-column customer widgets -->
    <div class="grid grid-2">
    
    	<!-- Active Stylists on Staff -->
	    <section class="glass-card home-card">
	        <h3>Stylists Working Today</h3>

		    <div class="accent-line"></div>
		
		    <!-- No stylists -->
		    <div th:if="${stylistDayViews == null or #lists.isEmpty(stylistDayViews)}">
		        <p class="subtext">No stylists scheduled today.</p>
		    </div>
		
		    <!-- List stylists -->
		    <div th:each="view : ${stylistDayViews}" style="margin-bottom:12px;">
		
		        <p class="subtext">
		            <strong th:text="${view.stylist.firstName}"></strong>
		        </p>
		
		        <p class="subtext">
		            <span th:text="${view.availability.dayStartTime}"></span>
		            —
		            <span th:text="${view.availability.dayEndTime}"></span>
		        </p>
		
		        <!-- Breaks -->
		        <div th:if="${view.availability.breakTimes != null 
		                     and !#lists.isEmpty(view.availability.breakTimes)}"
		             class="subtext"
		             style="margin-left:12px;">
		
		            <div th:each="b : ${view.availability.breakTimes}">
		                Break:
		                <span th:text="${b.breakStartTime}"></span>
		                —
		                <span th:text="${b.breakEndTime}"></span>
		            </div>
		
		        </div>
		
		    </div>
	    </section>
	    
	    <!-- Top Service Categories -->
	    <section class="glass-card home-card">
	        <h3>Top Services</h3>
	        
	        <div class="accent-line"></div>
	
	        <div th:if="${topBusinessServices != null and #lists.size(topBusinessServices) > 0}">
	            <ul style="list-style: none; padding:0; margin:0; text-align:left; font-size:0.85rem; color:var(--muted)">
	                <li th:each="s, i : ${topBusinessServices}"
	                    th:if="${i.index < 3}" style="margin-bottom:4px;">
	                    <strong th:text="${s.name}" style="color:var(--purple-1);"></strong>
	                    — <span th:text="${s.count}"></span> performed
	                </li>
	            </ul>
	        </div>
	
	        <div th:if="${topBusinessServices == null or #lists.size(topBusinessServices) == 0}">
	            <p class="subtext">No top service data available.</p>
	        </div>
	    </section>
	    
	    
	    
	</div>
	  
	<!-- Two-column customer widgets -->
    <div class="grid grid-2">
    
    	<!-- Total Appointments Today -->
	    <section class="glass-card home-card">
	        <h3>Appointments Today</h3>
	        
	        <div class="accent-line"></div>
	
	        <!-- If data available -->
	        <div th:if="${appointmentsToday != null}">
	            <p class="subtext">
	                <strong th:text="${appointmentsToday}"
	                        style="font-size:1.05rem; color:var(--purple-1)"></strong>
	                total appointments today
	            </p>
	        </div>
	
	        <!-- If no data -->
	        <div th:if="${appointmentsToday == null}">
	            <p class="subtext">No appointment metrics available.</p>
	        </div>
	    </section>
    	
    	<!-- Total Services Completed (All Stylists) -->
		<section class="glass-card home-card">
		    <h3>Total Services Completed</h3>
		
		    <div class="accent-line"></div>
		    <p class="subtext">Lifetime service count from all stylists</p>
		
		    <!-- If service count available -->
		    <div th:if="${totalServicesCompleted != null}">
		        <p class="subtext">
		            <strong th:text="${totalServicesCompleted}"
		                    style="font-size:1.05rem; color:var(--purple-1)">
		            </strong>
		            total completed services
		        </p>
		    </div>
		
		    <!-- If no data yet -->
		    <div th:if="${totalServicesCompleted == null}">
		        <p class="subtext">No service completion data available.</p>
		    </div>
		</section>
    	
    	
	    
    </div>
    	

</main>


</body>
</html>
