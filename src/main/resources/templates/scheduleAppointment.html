<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Schedule Appointment</title>
    <link rel="stylesheet" href="/css/lilliputSalon.css" />
</head>

<body class="page-gradient">

<header>
    <div th:replace="~{fragments/customer-nav :: customerNav}"></div>
</header>

<main class="services-layout">

    <h2>Schedule an Appointment</h2>

    <form method="post"
	      action="/schedule/create"
	      class="glass-card wide">


        <!-- SERVICES -->
        <h3>Select Services</h3>
		<div class="accent-line"></div>
		
		<div id="serviceList">
		    <div th:each="service : ${services}"
		         class="service-btn"
		         th:text="${service.name}"
		         th:attr="data-id=${service.id}">
		    </div>
		</div>
		
		<!-- Hidden inputs injected by JS -->
		<div id="selectedServices"></div>


        <!-- STYLIST -->
        <h3 style="margin-top:24px;">Choose a Stylist</h3>
        <div class="accent-line"></div>

        <select name="stylistId" required class="input">
            <option value="">Select a stylist</option>

            <option th:each="a : ${availableStylists}"
                    th:value="${a.user.id}"
                    th:text="${a.user.profile.firstName + ' ' + a.user.profile.lastName}">
            </option>
        </select>

        <!-- DATE -->
        <h3 style="margin-top:24px;">Choose a Date</h3>
        <div class="accent-line"></div>

        <input type="date"
               name="date"
               class="input"
               required />

        <!-- TIME -->
        <h3 style="margin-top:24px;">Choose a Time</h3>
        <div class="accent-line"></div>

        <input type="time"
               name="time"
               class="input"
               required />

        <!-- SUBMIT -->
        <button type="submit"
                class="btn btn-secondary"
                style="margin-top:24px;">
            Book Appointment
        </button>

    </form>

</main>

</body>
</html>

<script>
    const selectedServiceIds = new Set();

    const serviceButtons = document.querySelectorAll('.service-btn');
    const hiddenContainer = document.getElementById('selectedServices');

    serviceButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const serviceId = btn.dataset.id;

            if (selectedServiceIds.has(serviceId)) {
                selectedServiceIds.delete(serviceId);
                btn.classList.remove('selected');
            } else {
                selectedServiceIds.add(serviceId);
                btn.classList.add('selected');
            }

            syncHiddenInputs();
        });
    });

    function syncHiddenInputs() {
        hiddenContainer.innerHTML = '';

        selectedServiceIds.forEach(id => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'serviceIds';
            input.value = id;
            hiddenContainer.appendChild(input);
        });
    }
</script>

