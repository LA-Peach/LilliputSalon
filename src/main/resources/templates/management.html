<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Manage Services</title>
    <link rel="stylesheet" href="/css/lilliputSalon.css">
</head>

<body class="page-gradient">
<header th:replace="~{fragments/owner-nav :: ownerNav}"></header>

<!-- ==========================
     SERVICES
	=========================== -->

<main class="container">

    <h2>Service Management</h2>

    <a href="javascript:void(0)" onclick="openAddModal()" class="btn-primary">
	    Add New Service
	</a>


    <div th:if="${param.success}" class="message logout">Service created!</div>
    <div th:if="${param.updated}" class="message logout">Service updated!</div>
    <div th:if="${param.deactivated}" class="message error">Service deactivated.</div>

    <div th:each="category : ${categories}" class="glass-card" style="width:100%;">
        <h3 th:text="${category.categoryName}"></h3>
        <div class="accent-line"></div>

        <table style="width:100%; margin-top:12px;">
            <tr th:each="service : ${category.services}">
                <td th:text="${service.name}"></td>
                <td th:text="${service.basePrice}" style="text-align:right;"></td>

                <td>
                    <a th:href="@{/services/edit/{id}(id=${service.id})}"
                       class="btn-secondary">Edit</a>
                </td>

                <td>
                    <form th:action="@{/services/deactivate/{id}(id=${service.id})}"
                          method="post">
                        <button class="btn-primary" style="background:#a33;">Deactivate</button>
                    </form>
                </td>
            </tr>
        </table>
    </div>
    
    <!-- ==========================
     ADD / EDIT MODAL
	=========================== -->
	<div id="serviceModal" class="modal-overlay" style="display:none">
	    <div class="modal-card glass-card">
	
	        <h2 id="modalTitle">Service</h2>
	
	        <form id="serviceForm" method="post">
	
	            <input type="hidden" name="id" id="serviceId">
	
	            <div class="field-group">
	                <label>Category</label>
	                <select name="category.id" id="categorySelect" required>
	                    <option th:each="c : ${categories}"
	                            th:value="${c.id}"
	                            th:text="${c.categoryName}">
	                    </option>
	                </select>
	            </div>
	
	            <div class="field-group">
	                <label>Service Name</label>
	                <input name="name" id="serviceName" required />
	            </div>
	
	            <div class="field-group">
	                <label>Description</label>
	                <textarea name="description" id="serviceDescription"></textarea>
	            </div>
	
	            <div class="field-group">
	                <label>Base Price</label>
	                <input type="number" step="0.01" name="basePrice" id="servicePrice" required />
	            </div>
	
	            <div class="field-group">
	                <label>Typical Duration (Minutes)</label>
	                <input type="number" name="typicalDurationMinutes" id="serviceDuration" required />
	            </div>
	
	            <button type="submit" class="btn-primary">Save</button>
	        </form>
	
	        <button class="btn-secondary" onclick="closeModal()">Cancel</button>
	
	    </div>
	</div>
    

</main>

</body>
<script>
function openAddModal() {
    document.getElementById("modalTitle").innerText = "Add Service";
    document.getElementById("serviceForm").action = "/services/add";

    document.getElementById("serviceId").value = "";
    document.getElementById("serviceName").value = "";
    document.getElementById("serviceDescription").value = "";
    document.getElementById("servicePrice").value = "";
    document.getElementById("serviceDuration").value = "";

    document.getElementById("serviceModal").style.display = "flex";
}

function openEditModal(id, name, description, price, duration, categoryId) {
    document.getElementById("modalTitle").innerText = "Edit Service";
    document.getElementById("serviceForm").action = "/services/edit";

    document.getElementById("serviceId").value = id;
    document.getElementById("serviceName").value = name;
    document.getElementById("serviceDescription").value = description;
    document.getElementById("servicePrice").value = price;
    document.getElementById("serviceDuration").value = duration;
    document.getElementById("categorySelect").value = categoryId;

    document.getElementById("serviceModal").style.display = "flex";
}

function closeModal() {
    document.getElementById("serviceModal").style.display = "none";
}
</script>

</html>


