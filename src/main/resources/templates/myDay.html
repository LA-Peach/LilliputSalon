<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <title>My Day</title>
    <link rel="stylesheet" href="/css/lilliputSalon.css" />
</head>

<body class="page-gradient">

<header>
    <div th:replace="~{fragments/stylist-nav :: stylistNav}"></div>
</header>

<main class="services-layout">

    <!-- PAGE TITLE -->
    <h2 style="text-align:center;">
        Appointments for
        <span th:text="${#temporals.format(displayDate, 'EEEE, MMMM d, yyyy')}"></span>
    </h2>

    <!-- NO APPOINTMENTS AT ALL -->
    <div th:if="${appointmentsByStylist == null or appointmentsByStylist.isEmpty()}"
         class="glass-card"
         style="max-width:720px;">
        <p><strong>No appointments scheduled.</strong></p>
    </div>

    <!-- LOOP PER STYLIST -->
    <div th:each="entry : ${appointmentsByStylist}">

        <!-- STYLIST HEADER (OWNER ONLY) -->
        <h2 th:if="${isOwnerView}"
            th:text="${entry.key.firstName}"
            style="margin-top:32px;">
        </h2>

        <!-- LOOP PER APPOINTMENT -->
        <div th:each="appt : ${entry.value}"
             class="glass-card"
             style="max-width:720px;">

            <!-- HEADER -->
            <h3>
                <span th:text="${#temporals.format(appt.scheduledStartDateTime, 'h:mm a')}"></span>
                —
                <span th:text="${appt.isCompleted ? 'Completed' : appt.status}"></span>
            </h3>

            <div class="accent-line"></div>

            <!-- CLIENT -->
            <p class="subtext">
                <strong>Client:</strong>
                <span th:text="${customerNames[appt.appointmentId]}"></span>
            </p>

            <!-- DURATION -->
            <p class="subtext">
                <strong>Duration:</strong>
                <span th:text="${appt.durationMinutes + ' min'}"></span>
            </p>

            <!-- SERVICES -->
            <div style="margin-top:12px;">
                <strong>Services:</strong>
                <ul style="list-style:none; padding-left:0; margin:8px 0;">
                    <li th:each="service : ${servicesByAppt[appt.appointmentId]}">
                        <span th:text="${service.service.name}"></span>
                        —
                        <span th:text="${service.actualDurationMinutes + ' min'}"></span>
                    </li>
                </ul>
            </div>

            <!-- COMPLETE BUTTON (STYLIST ONLY, NOT COMPLETED) -->
            <div th:if="${!appt.isCompleted and !isOwnerView}">
                <form th:action="@{/stylist/completeAppointment}"
                      method="post"
                      style="margin-top:12px;">
                    <input type="hidden"
                           name="appointmentId"
                           th:value="${appt.appointmentId}" />
                    <button type="submit"
                            class="btn btn-secondary">
                        Complete Appointment
                    </button>
                </form>
            </div>

        </div>

    </div>

</main>

</body>
</html>
